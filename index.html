
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SENATOR OPTICS - Virtual Try-On</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script type="importmap">
{
  "imports": {
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.29.0",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0"
  }
}
</script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Lalezar&family=Vazirmatn:wght@400;700&display=swap');

    :root {
        --color-gold: #daa520;
        --color-dark: #121212;
        --color-light-gray: #e5e7eb;
        --color-dark-gray: #374151;
        --font-persian: 'Vazirmatn', sans-serif;
        --font-english: 'Lalezar', cursive;
    }

    body {
        background-color: var(--color-dark);
        background-image: url('https://novinresaneh.com/data/uploads/2025/11/black-elegant-background-with-wave-gold-line-modern-luxury_494423-22723.jpg);
        background-size: cover;
        background-position: center center;
        background-attachment: fixed;
        color: var(--color-light-gray);
        position: relative;
        font-family: var(--font-persian) !important;
    }
    
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: -1;
    }

    header h1 {
        font-family: var(--font-english) !important;
    }
    
    .comparator {
        position: relative;
        overflow: hidden;
        width: 100%;
        max-width: 500px;
        aspect-ratio: 1 / 1;
        border: 2px solid var(--color-gold);
        border-radius: 0.5rem;
    }
    .comparator img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        pointer-events: none;
    }
    .comparator .edited {
        clip-path: inset(0 50% 0 0);
    }
    .comparator .slider {
        position: absolute;
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 100%;
        background: transparent;
        outline: none;
        margin: 0;
        cursor: col-resize;
    }
    .comparator .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 4px;
        height: 100%;
        background: var(--color-gold);
        cursor: col-resize;
    }
</style>
</head>
<body class="bg-gray-900 text-white">
    <div id="root"></div>
    <script type="module">
import React, { useState, useCallback, useRef, useEffect } from 'react';
import ReactDOM from 'react-dom/client';

// --- START: constants.ts ---
const EYEGLASS_BRANDS = [
    {
        brandName: "Ray-Ban",
        models: [
            { name: "Aviator (Sunglass)", prompt: "Place classic Ray-Ban Aviator sunglasses (model 3025) with a gold metal frame and dark green G-15 lenses onto the person's face, ensuring a natural and realistic fit." },
            { name: "Wayfarer (Sunglass)", prompt: "Place iconic Ray-Ban Wayfarer sunglasses (model 2140) in polished black acetate with green G-15 lenses onto the person's face, ensuring a natural and realistic fit." },
            { name: "Clubmaster (Optical)", prompt: "Place Ray-Ban Clubmaster eyeglasses with a black browline and gold metal rims onto the person's face, ensuring a natural and realistic fit." },
        ]
    },
    {
        brandName: "Oakley",
        models: [
            { name: "Holbrook (Sunglass)", prompt: "Place Oakley Holbrook sunglasses with a matte black frame and Prizm Sapphire Iridium lenses onto the person's face, ensuring a natural and realistic fit." },
            { name: "Sutro (Sunglass)", prompt: "Place large, shield-style Oakley Sutro sunglasses with a black frame and Prizm Road lens onto the person's face, ensuring a natural and realistic fit." },
        ]
    },
    {
        brandName: "Gucci",
        models: [
            { name: "Square Sunglass", prompt: "Place oversized Gucci square sunglasses in black acetate with the gold interlocking G logo onto the person's face, ensuring a natural and realistic fit." },
            { name: "Rectangular Optical", prompt: "Place Gucci rectangular eyeglasses in a shiny black acetate frame onto the person's face, ensuring a natural and realistic fit." },
        ]
    },
];
// --- END: constants.ts ---


// --- START: services/geminiService.ts ---
const editImageWithGemini = async (image, prompt) => {
    const WORKER_URL = '/api';

    try {
        const response = await fetch(WORKER_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                imageBase64: image.base64,
                mimeType: image.mimeType,
                prompt: prompt,
            }),
        });
        
        if (!response.ok) {
            const errorData = await response.json().catch(() => ({ error: 'Failed to parse error response.' }));
            throw new Error(errorData.error || `Server responded with status ${response.status}`);
        }

        const data = await response.json();
        
        if (!data.newImageBase64) {
            throw new Error('Server response did not contain the new image.');
        }

        return data.newImageBase64;

    } catch (err) {
        console.error("Worker fetch error:", err);
        throw new Error(`خطا: ${err.message}. لطفاً دوباره امتحان کنید و از صحت تنظیمات ورکر Cloudflare اطمینان حاصل کنید.`);
    }
};
// --- END: services/geminiService.ts ---


// --- START: components/Loader.tsx ---
const Loader = ({ message }) => {
    return (
        React.createElement('div', { className: "absolute inset-0 bg-black bg-opacity-80 flex flex-col items-center justify-center z-50 backdrop-blur-md" },
            React.createElement('div', { className: "w-16 h-16 border-4 border-dashed rounded-full animate-spin border-amber-500" }),
            React.createElement('p', { className: "mt-4 text-lg font-semibold text-amber-400" }, message)
        )
    );
};
// --- END: components/Loader.tsx ---

// --- START: components/ImageComparator.tsx ---
const ImageComparator = ({ originalSrc, editedSrc }) => {
    const sliderRef = useRef(null);
    const editedImageRef = useRef(null);

    useEffect(() => {
        const slider = sliderRef.current;
        const editedImage = editedImageRef.current;
        if (slider && editedImage) {
            const handleInput = () => {
                editedImage.style.clipPath = `inset(0 ${100 - slider.value}% 0 0)`;
            };
            slider.addEventListener('input', handleInput);
            return () => slider.removeEventListener('input', handleInput);
        }
    }, []);

    return (
        React.createElement('div', { className: "comparator shadow-2xl" },
            React.createElement('img', { src: originalSrc, alt: "Original" }),
            React.createElement('img', { ref: editedImageRef, src: editedSrc, alt: "Edited", className: "edited" }),
            React.createElement('input', {
                ref: sliderRef,
                type: 'range',
                min: '0',
                max: '100',
                defaultValue: '50',
                className: 'slider'
            })
        )
    );
};
// --- END: components/ImageComparator.tsx ---


// --- START: App.tsx ---
const fileToImageData = (file) => {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
            const base64String = reader.result.split(',')[1];
            resolve({ base64: base64String, mimeType: file.type, url: reader.result });
        };
        reader.onerror = error => reject(error);
        reader.readAsDataURL(file);
    });
};

const App = () => {
    const [userImage, setUserImage] = useState(null);
    const [editedImage, setEditedImage] = useState(null);
    const [isLoading, setIsLoading] = useState(false);
    const [loadingMessage, setLoadingMessage] = useState('');
    const [error, setError] = useState(null);
    const [activeBrand, setActiveBrand] = useState(EYEGLASS_BRANDS[0].brandName);

    const fileInputRef = useRef(null);
    const cameraInputRef = useRef(null);

    const handleImageUpload = async (event) => {
        const file = event.target.files?.[0];
        if (file) {
            setError(null);
            setEditedImage(null);
            const imageData = await fileToImageData(file);
            setUserImage(imageData);
        }
    };

    const processTryOnRequest = useCallback(async (stylePrompt) => {
        if (!userImage) {
            setError("لطفاً ابتدا یک تصویر آپلود کنید.");
            return;
        }
        
        setIsLoading(true);
        setLoadingMessage('AI در حال قرار دادن عینک روی چهره شماست...');
        setError(null);
        setEditedImage(null);

        try {
            const newImageBase64 = await editImageWithGemini(userImage, stylePrompt);
            const newImageUrl = `data:${userImage.mimeType};base64,${newImageBase64}`;
            setEditedImage(newImageUrl);
        } catch (err) {
            setError(err.message);
        } finally {
            setIsLoading(false);
        }
    }, [userImage]);
    
    const handleReset = () => {
        setUserImage(null);
        setEditedImage(null);
        setError(null);
    };

    const WelcomeScreen = () => (
        React.createElement('div', { className: "text-center p-8" },
            React.createElement('h1', { className: "text-5xl font-bold mb-4 text-amber-400" }, "SENATOR OPTICS"),
            React.createElement('p', { className: "text-xl text-gray-300 mb-8" }, "تست مجازی عینک با هوش مصنوعی"),
            React.createElement('div', { className: "flex flex-col sm:flex-row justify-center items-center gap-4" },
                React.createElement('button', { onClick: () => cameraInputRef.current?.click(), className: "w-full sm:w-auto bg-amber-500 hover:bg-amber-400 text-black font-bold py-3 px-6 rounded-full flex items-center justify-center gap-3 transition-transform transform hover:scale-105" },
                    React.createElement('i', { className: "fas fa-camera text-xl" }),
                    React.createElement('span', null, "گرفتن عکس با دوربین")
                ),
                React.createElement('button', { onClick: () => fileInputRef.current?.click(), className: "w-full sm:w-auto bg-black/50 border-2 border-amber-500/80 hover:bg-amber-500/20 text-white font-bold py-3 px-6 rounded-full flex items-center justify-center gap-3 transition-transform transform hover:scale-105" },
                    React.createElement('i', { className: "fas fa-upload text-xl" }),
                    React.createElement('span', null, "انتخاب از گالری")
                )
            ),
            React.createElement('input', { type: "file", ref: cameraInputRef, onChange: handleImageUpload, accept: "image/*", capture: "user", className: "hidden" }),
            React.createElement('input', { type: "file", ref: fileInputRef, onChange: handleImageUpload, accept: "image/*", className: "hidden" })
        )
    );
    
    return (
        React.createElement('div', { className: "min-h-screen flex flex-col p-4" },
            React.createElement('header', { className: "text-center mb-4 relative" },
                React.createElement('h1', { className: "text-2xl sm:text-3xl font-bold text-amber-400 inline-block" },
                    React.createElement('i', { className: "fas fa-glasses mr-2 text-amber-500" }),
                    "SENATOR OPTICS"
                )
            ),
            React.createElement('main', { className: "flex-grow flex flex-col items-center justify-center" },
                isLoading && React.createElement(Loader, { message: loadingMessage }),
                error && React.createElement('div', { className: "bg-red-800 border border-red-600 text-white p-3 rounded-lg my-4 max-w-xl text-center", dir: "rtl" }, error),
                !userImage ? React.createElement(WelcomeScreen, null) : (
                    React.createElement('div', { className: "w-full flex flex-col items-center gap-6" },
                        
                        editedImage ? 
                            React.createElement(ImageComparator, { originalSrc: userImage.url, editedSrc: editedImage }) :
                            React.createElement('img', { src: userImage.url, alt: "Uploaded photo", className: "max-w-md w-full aspect-square object-cover rounded-lg shadow-2xl border-2 border-amber-500/30" }),

                        React.createElement('div', { className: "w-full max-w-4xl p-4 sm:p-6 bg-black/70 border border-amber-500/30 rounded-lg backdrop-blur-sm" },
                            React.createElement('div', { className: "w-full max-w-3xl mx-auto" },
                                React.createElement('p', { className: "text-center text-gray-300 mb-4", dir: "rtl" }, "برای تست مجازی، یک مدل را انتخاب کنید:"),
                                
                                React.createElement('div', { className: "flex justify-center border-b border-amber-500/30 mb-4 flex-wrap" },
                                    EYEGLASS_BRANDS.map(brand => (
                                        React.createElement('button', {
                                            key: brand.brandName,
                                            onClick: () => setActiveBrand(brand.brandName),
                                            className: `px-4 py-2 text-lg font-semibold transition-colors ${activeBrand === brand.brandName ? 'text-amber-400 border-b-2 border-amber-400' : 'text-gray-400 hover:text-amber-400'}`
                                        }, brand.brandName)
                                    ))
                                ),

                                React.createElement('div', { className: "mb-4 min-h-[80px] flex flex-wrap justify-center items-center gap-3" },
                                    EYEGLASS_BRANDS.find(b => b.brandName === activeBrand)?.models.map(model => (
                                        React.createElement('button', { 
                                            key: model.name, 
                                            onClick: () => processTryOnRequest(model.prompt), 
                                            disabled: isLoading, 
                                            className: "bg-black/50 border border-amber-500/50 hover:bg-amber-500/20 text-sm font-semibold py-2 px-4 rounded-full transition-colors disabled:bg-gray-800 disabled:text-gray-500 disabled:border-gray-700 disabled:cursor-not-allowed" 
                                        },
                                            model.name
                                        )
                                    ))
                                )
                            ),
                            React.createElement('div', { className: "flex flex-col sm:flex-row gap-4 mt-6 justify-center" },
                                React.createElement('button', { onClick: handleReset, disabled: isLoading, className: "bg-red-800/80 hover:bg-red-700 border border-red-600 text-white font-bold py-3 px-6 rounded-full flex items-center justify-center gap-3 transition-colors" },
                                    React.createElement('i', { className: "fas fa-trash" }),
                                    React.createElement('span', null, "شروع مجدد")
                                )
                            )
                        )
                    )
                )
            )
        )
    );
};
// --- END: App.tsx ---


// --- START: index.tsx ---
const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(React.createElement(React.StrictMode, null, React.createElement(App, null)));
// --- END: index.tsx ---
    </script>
</body>
</html>
