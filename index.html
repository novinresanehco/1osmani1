
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SENATOR OPTICS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script type="importmap">
{
  "imports": {
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.29.0",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0"
  }
}
</script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Lalezar&family=Vazirmatn:wght@400;700&display=swap');

    :root {
        --color-gold: #daa520;
        --color-dark: #121212;
        --color-light-gray: #e5e7eb;
        --color-dark-gray: #374151;
        --font-persian: 'Vazirmatn', sans-serif;
        --font-english: 'Lalezar', cursive;
    }

    body {
        background-color: var(--color-dark);
        background-image: url('https://novinresaneh.com/data/uploads/2025/11/black-elegant-background-with-wave-gold-line-modern-luxury_494423-22723.jpg);
        background-size: cover;
        background-position: center center;
        background-attachment: fixed;
        color: var(--color-light-gray);
        position: relative;
        font-family: var(--font-persian) !important;
    }
    
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.7);
        z-index: -1;
    }

    header h1 {
        font-family: var(--font-english) !important;
    }
    
    .markdown-output p {
        margin-bottom: 1rem;
    }
    .markdown-output ul {
        list-style-type: disc;
        margin-left: 1.5rem;
        margin-bottom: 1rem;
    }
</style>
</head>
<body class="bg-gray-900 text-white">
    <div id="root"></div>
    <script type="module">
import React, { useState, useCallback, useRef, useEffect } from 'react';
import ReactDOM from 'react-dom/client';
import { marked } from 'https://cdn.jsdelivr.net/npm/marked/lib/marked.esm.js';

// --- START: constants.ts ---
const EYEGLASS_BRANDS = [
    {
        brandName: "Ray-Ban",
        models: [
            { name: "Aviator (Sunglass)", prompt: "classic Ray-Ban Aviator sunglasses (model 3025) with a gold metal frame and dark green G-15 lenses" },
            { name: "Wayfarer (Sunglass)", prompt: "iconic Ray-Ban Wayfarer sunglasses (model 2140) in polished black acetate with green G-15 lenses" },
            { name: "Clubmaster (Optical)", prompt: "Ray-Ban Clubmaster eyeglasses with a black browline and gold metal rims" },
            { name: "Round Metal (Optical)", prompt: "Ray-Ban Round Metal eyeglasses (model RX3447V) with a thin gold frame" }
        ]
    },
    {
        brandName: "Oakley",
        models: [
            { name: "Holbrook (Sunglass)", prompt: "Oakley Holbrook sunglasses with a matte black frame and Prizm Sapphire Iridium lenses" },
            { name: "Sutro (Sunglass)", prompt: "large, shield-style Oakley Sutro sunglasses with a black frame and Prizm Road lens" },
            { name: "Holbrook (Optical)", prompt: "Oakley Holbrook eyeglasses with a matte black frame" },
            { name: "Metalink (Optical)", prompt: "Oakley Metalink eyeglasses with a satin black rectangular frame" }
        ]
    },
    {
        brandName: "Gucci",
        models: [
            { name: "Square Sunglass", prompt: "oversized Gucci square sunglasses in black acetate with the gold interlocking G logo" },
            { name: "Aviator Sunglass", prompt: "Gucci aviator sunglasses with a gold metal frame and a double bridge" },
            { name: "Rectangular Optical", prompt: "Gucci rectangular eyeglasses in a shiny black acetate frame" },
        ]
    },
    {
        brandName: "Persol",
        models: [
            { name: "649 (Sunglass)", prompt: "iconic Persol 649 sunglasses in a havana tortoise-shell acetate frame with the signature silver arrow hinge" },
            { name: "714 (Sunglass)", prompt: "foldable Persol 714 'Steve McQueen' sunglasses in a light havana frame" },
            { name: "Cellor (Optical)", prompt: "Persol Cellor eyeglasses with a black acetate browline and metal lower rims" },
        ]
    }
];
// --- END: constants.ts ---


// --- START: services/geminiService.ts ---
const getStyleAdvice = async (image, prompt) => {
    const WORKER_URL = '/api';

    try {
        const response = await fetch(WORKER_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                imageBase64: image.base64,
                mimeType: image.mimeType,
                prompt: prompt,
            }),
        });
        
        if (!response.ok) {
            let errorMsg = `خطای سرور: ${response.status}`;
            try {
                const errorData = await response.json();
                if (errorData.error) {
                    errorMsg = errorData.error;
                }
            } catch (e) {
                console.log("Could not parse error response as JSON.");
            }
            throw new Error(errorMsg);
        }

        const data = await response.json();
        
        if (!data.styleAdvice) {
            throw new Error('پاسخ سرور فاقد مشاوره استایل بود.');
        }

        return data.styleAdvice;

    } catch (err) {
        console.error("Worker fetch error:", err);
        const friendlyMessage = err.message.includes('Failed to fetch') 
            ? 'خطا در اتصال به سرور. لطفاً از اتصال اینترنت خود و صحیح بودن آدرس ورکر اطمینان حاصل کنید.'
            : `خطا: ${err.message}. لطفاً تنظیمات ورکر Cloudflare خود را بررسی کنید (کلید API، Project ID، و فعال بودن Vertex AI API).`;
        throw new Error(friendlyMessage);
    }
};
// --- END: services/geminiService.ts ---


// --- START: components/Loader.tsx ---
const Loader = ({ message }) => {
    return (
        React.createElement('div', { className: "absolute inset-0 bg-black bg-opacity-80 flex flex-col items-center justify-center z-50 backdrop-blur-md" },
            React.createElement('div', { className: "w-16 h-16 border-4 border-dashed rounded-full animate-spin border-amber-500" }),
            React.createElement('p', { className: "mt-4 text-lg font-semibold text-amber-400" }, message)
        )
    );
};
// --- END: components/Loader.tsx ---


// --- START: components/StyleAdviceCard.tsx ---
const StyleAdviceCard = ({ advice, imageUrl }) => {
    const parsedHtml = marked(advice);
    return (
        React.createElement('div', {className: "w-full max-w-4xl mx-auto flex flex-col md:flex-row items-center md:items-start gap-6 bg-black/70 border border-amber-500/30 rounded-lg p-6 backdrop-blur-sm"},
            React.createElement('img', {
                src: imageUrl,
                alt: "Your photo",
                className: "w-48 h-48 object-cover rounded-lg shadow-lg border-2 border-amber-500/50"
            }),
            React.createElement('div', {className: "text-right flex-1"},
                React.createElement('h3', {className: "text-2xl font-bold text-amber-400 mb-4 border-b-2 border-amber-500/30 pb-2"}, "مشاوره استایل شما"),
                React.createElement('div', {
                    className: "text-gray-200 leading-relaxed markdown-output",
                    dangerouslySetInnerHTML: { __html: parsedHtml }
                })
            )
        )
    );
};
// --- END: components/StyleAdviceCard.tsx ---


// --- START: App.tsx ---
const fileToImageData = async (file) => {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => {
            const base64String = reader.result.split(',')[1];
            if (base64String) {
                resolve({ base64: base64String, mimeType: file.type, url: reader.result });
            } else {
                reject(new Error("Failed to read file as base64"));
            }
        };
        reader.onerror = error => reject(error);
        reader.readAsDataURL(file);
    });
};

const App = () => {
    const [userImage, setUserImage] = useState(null);
    const [styleAdvice, setStyleAdvice] = useState('');
    const [isLoading, setIsLoading] = useState(false);
    const [loadingMessage, setLoadingMessage] = useState('');
    const [error, setError] = useState(null);
    const [activeBrand, setActiveBrand] = useState(EYEGLASS_BRANDS[0].brandName);

    const fileInputRef = useRef(null);
    const cameraInputRef = useRef(null);

    const handleImageUpload = async (event) => {
        const file = event.target.files?.[0];
        if (file) {
            setError(null);
            setStyleAdvice('');
            try {
                const imageData = await fileToImageData(file);
                setUserImage(imageData);
            } catch (err) {
                setError("Could not process the image file.");
                console.error(err);
            }
        }
    };

    const processStyleRequest = useCallback(async (stylePrompt) => {
        if (!userImage) {
            setError("لطفاً ابتدا یک تصویر آپلود کنید.");
            return;
        }
        
        setIsLoading(true);
        setLoadingMessage('هوش مصنوعی در حال تحلیل استایل شماست...');
        setError(null);
        setStyleAdvice('');

        try {
            const adviceText = await getStyleAdvice(userImage, stylePrompt);
            setStyleAdvice(adviceText);
        } catch (err) {
            setError(err.message || "Failed to get style advice. Please try again.");
            console.error(err);
        } finally {
            setIsLoading(false);
        }
    }, [userImage]);

    const WelcomeScreen = () => (
        React.createElement('div', { className: "text-center p-8" },
            React.createElement('h1', { className: "text-5xl font-bold mb-4 text-amber-400" }, "SENATOR OPTICS"),
            React.createElement('p', { className: "text-xl text-gray-300 mb-8" }, "مشاور استایل هوشمند عینک شما"),
            React.createElement('div', { className: "flex flex-col sm:flex-row justify-center items-center gap-4" },
                React.createElement('button', { onClick: () => cameraInputRef.current?.click(), className: "w-full sm:w-auto bg-amber-500 hover:bg-amber-400 text-black font-bold py-3 px-6 rounded-full flex items-center justify-center gap-3 transition-transform transform hover:scale-105" },
                    React.createElement('i', { className: "fas fa-camera text-xl" }),
                    React.createElement('span', null, "گرفتن عکس با دوربین")
                ),
                React.createElement('button', { onClick: () => fileInputRef.current?.click(), className: "w-full sm:w-auto bg-black/50 border-2 border-amber-500/80 hover:bg-amber-500/20 text-white font-bold py-3 px-6 rounded-full flex items-center justify-center gap-3 transition-transform transform hover:scale-105" },
                    React.createElement('i', { className: "fas fa-upload text-xl" }),
                    React.createElement('span', null, "انتخاب از گالری")
                )
            ),
            React.createElement('input', { type: "file", ref: cameraInputRef, onChange: handleImageUpload, accept: "image/*", capture: "user", className: "hidden" }),
            React.createElement('input', { type: "file", ref: fileInputRef, onChange: handleImageUpload, accept: "image/*", className: "hidden" })
        )
    );
    
    return (
        React.createElement('div', { className: "min-h-screen flex flex-col p-4" },
            React.createElement('header', { className: "text-center mb-4 relative" },
                React.createElement('h1', { className: "text-2xl sm:text-3xl font-bold text-amber-400 inline-block" },
                    React.createElement('i', { className: "fas fa-glasses mr-2 text-amber-500" }),
                    "SENATOR OPTICS"
                )
            ),
            React.createElement('main', { className: "flex-grow flex flex-col items-center justify-center" },
                isLoading && React.createElement(Loader, { message: loadingMessage }),
                error && React.createElement('div', { className: "bg-red-800 border border-red-600 text-white p-3 rounded-lg my-4 max-w-xl text-center", dir: "rtl" }, error),
                !userImage ? React.createElement(WelcomeScreen, null) : (
                    React.createElement('div', { className: "w-full flex flex-col items-center gap-6" },
                        
                        styleAdvice ? 
                            React.createElement(StyleAdviceCard, { advice: styleAdvice, imageUrl: userImage.url }) :
                            React.createElement('img', { src: userImage.url, alt: "Uploaded photo", className: "max-w-md w-full aspect-square object-cover rounded-lg shadow-2xl border-2 border-amber-500/30" }),

                        React.createElement('div', { className: "w-full max-w-4xl p-4 sm:p-6 bg-black/70 border border-amber-500/30 rounded-lg backdrop-blur-sm" },
                            React.createElement('div', { className: "w-full max-w-3xl mx-auto" },
                                React.createElement('p', { className: "text-center text-gray-300 mb-4", dir: "rtl" }, "برای دریافت مشاوره استایل، یک مدل را انتخاب کنید:"),
                                
                                React.createElement('div', { className: "flex justify-center border-b border-amber-500/30 mb-4 flex-wrap" },
                                    EYEGLASS_BRANDS.map(brand => (
                                        React.createElement('button', {
                                            key: brand.brandName,
                                            onClick: () => setActiveBrand(brand.brandName),
                                            className: `px-4 py-2 text-lg font-semibold transition-colors ${activeBrand === brand.brandName ? 'text-amber-400 border-b-2 border-amber-400' : 'text-gray-400 hover:text-amber-400'}`
                                        }, brand.brandName)
                                    ))
                                ),

                                React.createElement('div', { className: "mb-4 min-h-[80px] flex flex-wrap justify-center items-center gap-3" },
                                    EYEGLASS_BRANDS.find(b => b.brandName === activeBrand)?.models.map(model => (
                                        React.createElement('button', { 
                                            key: model.name, 
                                            onClick: () => processStyleRequest(model.prompt), 
                                            disabled: isLoading, 
                                            className: "bg-black/50 border border-amber-500/50 hover:bg-amber-500/20 text-sm font-semibold py-2 px-4 rounded-full transition-colors disabled:bg-gray-800 disabled:text-gray-500 disabled:border-gray-700 disabled:cursor-not-allowed" 
                                        },
                                            model.name
                                        )
                                    ))
                                )
                            ),
                            React.createElement('div', { className: "flex flex-col sm:flex-row gap-4 mt-6 justify-center" },
                                React.createElement('button', { onClick: () => { setUserImage(null); setStyleAdvice(''); }, disabled: isLoading, className: "bg-red-800/80 hover:bg-red-700 border border-red-600 text-white font-bold py-3 px-6 rounded-full flex items-center justify-center gap-3 transition-colors" },
                                    React.createElement('i', { className: "fas fa-trash" }),
                                    React.createElement('span', null, "شروع مجدد")
                                )
                            )
                        )
                    )
                )
            )
        )
    );
};
// --- END: App.tsx ---


// --- START: index.tsx ---
const rootElement = document.getElementById('root');
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}

const root = ReactDOM.createRoot(rootElement);
root.render(
  React.createElement(React.StrictMode, null, React.createElement(App, null))
);
// --- END: index.tsx ---
    </script>
</body>
</html>
